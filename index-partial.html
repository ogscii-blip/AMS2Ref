<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMS2 Racing League</title>
    
    <!-- Modular CSS - using @import in main stylesheet -->
    <link rel="stylesheet" href="styles.css?v=4">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://thebuttkicker.com/cdn/shop/products/automobilista-2-logo.png?v=1656519455">
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; padding: 0 20px;">
                <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 10px;">
                    <img src="https://i.imgur.com/5ie13Vk.png" alt="Automobilista 2" style="max-width: 800px; width: 100%; height: auto;" id="desktopLogo">
                    <img src="https://images.launchbox-app.com/a8e90521-473b-480d-aa73-c2870aa75ea3.jpg" alt="AMS2" style="max-width: 120px; width: 100%; height: auto; display: none;" id="mobileLogo">
                    <p style="margin: 0; font-size: 1.2em; font-weight: 600; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);" id="subtitle">ABO AMS2 Racing League</p>
                </div>
                <div id="authSection" style="min-width: 200px;">
                    <div id="loginForm" style="display: flex; gap: 8px; align-items: center; justify-content: flex-end; flex-wrap: wrap;">
                        <input type="text" id="driverNameInput" placeholder="Driver Name" style="padding: 8px 12px; border-radius: 5px; border: 2px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.95); font-size: 0.9em; width: 140px;">
                        <input type="password" id="passwordInput" placeholder="Password" style="padding: 8px 12px; border-radius: 5px; border: 2px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.95); font-size: 0.9em; width: 130px;">
                        <button onclick="login()" style="background: #4CAF50; color: white; border: none; padding: 9px 18px; border-radius: 5px; cursor: pointer; font-size: 0.9em; font-weight: bold; white-space: nowrap;">Sign In</button>
                    </div>
                    <div id="userInfo" style="display: none; background: rgba(255,255,255,0.15); padding: 16px 20px; border-radius: 12px; backdrop-filter: blur(10px);">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div id="userPhotoContainer" style="position: relative; display: none; flex-shrink: 0;">
                                <img id="userProfilePhoto" src="" alt="Profile" style="width: 90px; height: 90px; border-radius: 50%; border: 3px solid white; object-fit: cover; display: block;">
                                <div id="userNumberBadge" style="position: absolute; bottom: -5px; right: -5px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.85em; font-weight: bold; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></div>
                            </div>
                            <div id="userIconFallback" style="display: none; font-size: 2.5em; flex-shrink: 0;">üë§</div>
                            <div style="display: flex; flex-direction: column; gap: 8px; flex: 1;">
                                <span style="font-size: 1.1em; color: white; font-weight: 600; margin-bottom: 4px;" id="userName"></span>
                                <button onclick="showTab('profile')" style="background: #667eea; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.85em; font-weight: 500; transition: background 0.2s; width: 100%;">My Profile</button>
                                <button onclick="signOut()" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.85em; font-weight: 500; transition: background 0.2s; width: 100%;">Sign Out</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('overall')">Overall Standings</button>
            <button class="tab-button" onclick="showTab('round')">Round Results</button>
            <button class="tab-button" onclick="showTab('submit')">Submit Time</button>
            <button class="tab-button" onclick="showTab('setup')">Round Setup</button>
            <button class="tab-button" onclick="showTab('drivers')">Drivers</button>
            <button class="tab-button" onclick="showTab('rules')">Rules & Scoring</button>
            <button class="tab-button" onclick="showTab('admin', this)" style="display: none;">üîß Admin</button>
        </div>

        <!-- Tab content sections remain the same as original HTML -->
        <!-- [Content omitted for brevity - use original HTML content] -->
        
        <!-- Overall Standings Tab -->
        <div id="overall" class="tab-content active">
            <h2>üèÜ Championship Standings</h2>
            
            <div style="margin-bottom: 20px; display: flex; gap: 15px; align-items: center;">
                <label for="seasonSelect" style="font-weight: bold; color: #333;">Season:</label>
                <select id="seasonSelect" onchange="loadLeaderboard()" style="padding: 8px 12px; border: 2px solid #ddd; border-radius: 5px; font-size: 1em; background: white;">
                    <option value="">All Seasons</option>
                </select>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="totalRounds">-</h3>
                    <p>Rounds Completed</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalDrivers">3</h3>
                    <p>Active Drivers</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalPoints">-</h3>
                    <p>Total Points Scored</p>
                </div>
            </div>

            <!-- Points Progression Graph -->
            <div id="points-progression-graph" style="display: none; background: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);"></div>

            <div id="leaderboard-loading" class="loading">Loading leaderboard data...</div>
            <div id="leaderboard-content" style="display: none;">
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Position</th>
                            <th>Driver</th>
                            <th>Total Points</th>
                            <th>Purple Sectors</th>
                            <th>Wins</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-body"></tbody>
                </table>
            </div>
        </div>

        <!-- Additional tabs would go here - use original HTML -->
        <!-- ... -->

    </div>

<!-- Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<!-- Firebase SDK - MUST be type="module" -->
<script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getDatabase, ref, onValue, set, push, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

    const firebaseConfig = {
        apiKey: "AIzaSyBSDmq3qjRU0kQR0k0pau3nOiFUa1j8Xpg",
        authDomain: "ams2abo.firebaseapp.com",
        databaseURL: "https://ams2abo-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "ams2abo",
        storageBucket: "ams2abo.firebasestorage.app",
        messagingSenderId: "1008932609178",
        appId: "1:1008932609178:web:3a5e16f3f54de2f0c61323"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    window.firebaseDB = database;
    window.firebaseRef = ref;
    window.firebaseOnValue = onValue;
    window.firebaseSet = set;
    window.firebasePush = push;
    window.firebaseGet = get;

    console.log('‚úÖ Firebase initialized successfully!');
    
    // Wait for script.js to load, then initialize
    if (typeof loadConfig === 'function') {
        loadConfig();
        checkExistingSession();
        loadLeaderboard();
        setupSectorTimeInputs();
        loadTracksAndCars();
    }
</script>

<!-- Modular JavaScript files loaded in order -->
<script src="js/helpers.js?v=4"></script>
<script src="js/state.js?v=4"></script>
<script src="js/config.js?v=4"></script>
<script src="js/navigation.js?v=4"></script>
<script src="js/seasons.js?v=4"></script>
<script src="js/leaderboard.js?v=4"></script>
<script src="js/rounds.js?v=4"></script>
<script src="js/setup.js?v=4"></script>
<script src="js/charts.js?v=4"></script>
<script src="js/race-animation.js?v=4"></script>
<script src="js/drivers.js?v=4"></script>
<script src="js/profile.js?v=4"></script>
<script src="js/submission.js?v=4"></script>
<script src="js/admin.js?v=4"></script>
<script src="js/auth.js?v=4"></script>
<script src="js/utils.js?v=4"></script>
<script src="js/dom.js?v=4"></script>

</body>
</html>
